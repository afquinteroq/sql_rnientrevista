create or replace package GIC_CATEGORIZACION is

  -- Author  : JULIO.BOLANOS
  -- Created : 27/01/2014 15:47:48
  -- Purpose : 


--OBTIENE LOS PARENTEZCOS EXISTENTES
PROCEDURE GIC_OBTENER_PARENTESCOS(CURSOR_OUT OUT ACCIONSOCIAL.cursor_select);

--OBTIENE LOS TIPO DE CARACTERIZACION
PROCEDURE GIC_OBT_TIPOCARACTERIZACION(CURSOR_OUT OUT ACCIONSOCIAL.cursor_select);

--INSERTA REGISTROS EN LA TABLA GIC_PERSONA
PROCEDURE GIC_INSERT_PERSONAS
(
PNOMBRE IN NVARCHAR2,SNOMBRE IN NVARCHAR2,PAPELLIDO IN NVARCHAR2,SAPELLIDO IN NVARCHAR2,
 FNACIMIENTO IN DATE,TDOC IN NVARCHAR2,USUARIO IN NVARCHAR2,USU_FCREACION IN DATE,
 NDOCU IN NVARCHAR2,RELAC IN NVARCHAR2,
 ID_DECLAR IN INTEGER, ID_PERS_FUENTE IN INTEGER,
 T_VICTIMA IN NVARCHAR2,ID_SINIESTRO IN INTEGER,
 FUENTEE IN NVARCHAR2, ESTADO IN NVARCHAR2, IDPERMI IN INTEGER, VALSECUENCIA OUT NUMBER
);

--INSERTAR MIEMBROS HOGAR
PROCEDURE GIC_INSERT_MIEMBRO_HOGAR
  (
    IDHOGAR IN NVARCHAR2,
    ID_PERSONA IN INTEGER,  
    USUARIO IN NVARCHAR2,
    ID_USUARIO IN INTEGER,
    ENCUESTADA IN NVARCHAR2
  );

--INSERTAR HOGAR 
PROCEDURE GIC_INSERT_HOGAR
  (
    USUA_CREACION IN NVARCHAR2,
    ID_USUARIO IN INTEGER,
    ID_TIPO_CARACTERIZACION IN INTEGER
  );

PROCEDURE GIC_INSERT_HOGAR1
  (
    USUA_CREACION IN NVARCHAR2,
    ID_USUARIO IN INTEGER,
    ID_TIPO_CARACTERIZACION IN INTEGER,
    MARCADOR OUT NVARCHAR2
  );

--OBTIENE EL ID TIPOCARACTERIZACION
PROCEDURE GIC_OBTENER_ID_TIPOCARACT(NOMBRE_TIPO IN NVARCHAR2,ID_TIPOCAR OUT INTEGER);

--OBTENER EL ULTIMO HOGAR GENERADO POR EL USUARIO
PROCEDURE GIC_OBT_ULT_HOGARXUSUARIO(IDUSUARIO IN INTEGER,IDHOGAR OUT NVARCHAR2);

--OBTENER ID PERSONA
PROCEDURE GIC_IDPERSONA(NDOCUMENTO IN NVARCHAR2,PNOMBRE IN NVARCHAR2,IDPERSONA OUT INTEGER);

--VERIFICA SI UNA PERSONA EXISTA EN LA BD
PROCEDURE GIC_VERIFICA_PERSONAS(NDOCUMENTO IN NVARCHAR2,PNOMBRE IN NVARCHAR2,EXISTE OUT INTEGER);

--OBTIENE EL ID DEL PARENTESCO
PROCEDURE GIC_OBTENER_ID_PARENTESCO(PARENTESCO IN NVARCHAR2,ID_PARENTESCO OUT INTEGER);

--OBTIENE EL CAMPO JEFE DE HOGAR PARA REALIZAR COMPARACIONES
PROCEDURE GIC_OBTENER_JEFEHOGAR(IDJEFEHOGAR OUT INTEGER);

--INSERTA EL ARBOL GENEALOGICO CORRESPONDIENTE
PROCEDURE GIC_INSERT_ARBOLGENEALOGICO(IDPERSONA IN INTEGER,IDPARENTESCO IN INTEGER,IDPERSONA_ASOCIADA IN INTEGER);
--INSERTA EL VALIDADOR DEL ESTADO
PROCEDURE GIC_INSERT_VALIDADOR_HOGAR(IDPERSONA IN INTEGER, CODHOGAR IN  NVARCHAR2,VALIDADOR IN NVARCHAR2, VALIDADOR_TIPOPERSONA IN NVARCHAR2, VALIDADOR_TIPOPERFIL IN NVARCHAR2, IDINSTRUMENTO IN INTEGER  );

PROCEDURE GIC_INSERT_VALIDADOR_PARENT(IDPERSONA IN INTEGER, CODHOGAR IN  NVARCHAR2,VALIDADOR IN NVARCHAR2, IDINSTRUMENTO IN INTEGER  );

PROCEDURE GIC_INSERT_VALIDADOR_TIPOPER(IDPERSONA IN INTEGER, CODHOGAR IN  NVARCHAR2,VALIDADOR IN NVARCHAR2, IDINSTRUMENTO IN INTEGER  );

PROCEDURE GIC_OBTENER_ESTADOPER(pPER_IDPERSONA IN INTEGER,ESTADO OUT NVARCHAR2);

--VALIDA SI EXISTE EL CODIGO DE HOGAR
PROCEDURE GIC_VALIDA_CODIGO(pCODIGO IN NVARCHAR2 ,TOTAL OUT INTEGER);

--VALIDA SI UN COIDGO D EHOGAR TIENE ASOCIADO MIEMBROS
PROCEDURE GIC_VALIDA_MIEMBROS(pCODIGO IN NVARCHAR2 ,TOTAL OUT INTEGER);

--INSERTA FAMILA TEMPORAL
PROCEDURE GIC_INSERT_FAMILIA (pdocumento IN NVARCHAR2, pnombres IN NVARCHAR2, phecho IN  NVARCHAR2,pnombre1 IN NVARCHAR2, 
  pnombre2 IN NVARCHAR2,papellido1 IN NVARCHAR2,papellido2 IN NVARCHAR2,  pid IN INTEGER);
  
    function FN_COMPROBARANDOMICO(ID in integer) return integer;
--    function FN_COMPROBARPADRE(IDTEMA in integer, PADRE  IN VARCHAR2) return integer;

--OBTIENE FAMILIA UNICA
PROCEDURE GIC_OBT_FAMILIA(pID IN NUMBER,CURSOR_OUT OUT ACCIONSOCIAL.cursor_select);
  
  --CONCATENA LOS HECHOS
FUNCTION FN_CONCATENAHECHOS(pCEDULA IN VARCHAR2, pID IN NUMBER)   RETURN VARCHAR2;
  
  --INSERTA EL VALIDADOR HECHO
PROCEDURE GIC_INSERT_VALIDADOR_HECHO_AUX(IDPERSONA IN INTEGER, CODHOGAR IN  NVARCHAR2,ID_HECHO IN INTEGER, IDINSTRUMENTO IN INTEGER, FECHA_HECHO IN  NVARCHAR2);

PROCEDURE GIC_INSERT_VALIDADOR_HECHO(IDPERSONA IN INTEGER, CODHOGAR IN  NVARCHAR2,VALIDADOR IN NVARCHAR2, IDINSTRUMENTO IN INTEGER  );
--OBTIENE FILTRO USUARIO
PROCEDURE FILTRA_USUARIOS(pUSUARIO IN NVARCHAR2,CURSOR_OUT OUT ACCIONSOCIAL.cursor_select);


--ELIMINA HOGAR TEMPORAL
PROCEDURE GIC_ELIMINAR_TEMP(pIDTEMP IN INTEGER);
    
--CONSULTA LOS MIEMBROS DEL HOGAR
PROCEDURE GIC_MIEMBROS_HOGAR(CODHOGAR IN NVARCHAR2, CURSOR_OUT OUT gic_cursor.cursor_select);


--VERIFICA SI EL ARCHIVO EXISTE
PROCEDURE GIC_EXISTE_COLILLA(CODHOGAR IN NVARCHAR2,CONTEO OUT INTEGER);

--ACTUALIZA ENCUESTADO
PROCEDURE GIC_ACTUALIZA_ENCUESTADO (pIdPersona IN NUMBER, pCodigo IN NVARCHAR2);

--CONSULTA LOS DATOS DELAS PERSONAS CARACTERIZADAS NO INCLUIDAS
PROCEDURE GIC_OBTENER_PERSONAS(NUMDOCUMENTO IN NVARCHAR2, CURSOR_OUT OUT gic_cursor.cursor_select);

PROCEDURE GIC_INSERT_PRUEBA (FNACIMIENTO IN DATE , T_VICTIMA IN NVARCHAR2,ID_SINIESTRO IN INTEGER);
--08/01/2020
--CONSULTA EL ESTADO DE LA PERSONA EN LA FICHA DE CARACTERIZACION, PARA SABER SI SE HABILITA PARA ENCUESTAR O NO
PROCEDURE GIC_VALIDAR_PERSONA_ENCUESTADA(NUMDOCUMENTO IN NVARCHAR2, idPerfilUsuario NVARCHAR2, CURSOR_OUT OUT gic_cursor.cursor_select);

PROCEDURE GIC_VALIDAR_PERSONA_ENCUESTAD1(NUMDOCUMENTO IN NVARCHAR2, idPerfilUsuario NVARCHAR2, RUTACARACTERIZACION NVARCHAR2, CURSOR_OUT OUT gic_cursor.cursor_select);

--CONSULTA SI HAY SOPORTE TUTOR CARGADO
PROCEDURE GIC_VALIDAR_ARCHIVO_SOPORTES(NUMDOCUMENTO IN NVARCHAR2, CURSOR_OUT OUT gic_cursor.cursor_select);

PROCEDURE GIC_INSERT_VALIDADOR_PERFIL(IDPERSONA IN INTEGER, CODHOGAR IN  NVARCHAR2,VALIDADOR IN NVARCHAR2, IDINSTRUMENTO IN INTEGER  );
PROCEDURE GIC_INSERT_VALIDADOR_ARES(CODHOGAR IN  NVARCHAR2 );

PROCEDURE GIC_EXISTE_CONSTANCIAFIRMADA(CODHOGAR IN NVARCHAR2,CONTEO OUT INTEGER);

FUNCTION FN_GET_HOGAR(pCODHOGAR IN VARCHAR2)RETURN NUMBER;

--17/03/2020 PARA ACTUALIZAR ESTADO PARA LA SAAH
FUNCTION FN_UPDATE_HOGAR_SAAH(pCODHOGAR IN VARCHAR2, pESTADO IN VARCHAR2, pIDUSUARIO IN VARCHAR2, pUSUARIO IN VARCHAR2)RETURN NUMBER;

end GIC_CATEGORIZACION;

 